[W 2025-12-17 03:03:16,384] Trial 0 failed with parameters: {'rsi_period': 19, 'rsi_low_th': 43.275000724347066, 'rsi_high_th': 80.61978796339918, 'tp_mode': 'pct', 'tp_pct': 1.6443457513284063, 'tp_mgmt': 'partial_trailing', 'tp1_close_frac': 0.5808920093945671, 'tp_trail_pct': 3.554959260090425, 'sl_type': 'atr', 'sl_trailing': False, 'exit_on_flat': True, 'sl_atr_period': 22, 'sl_atr_mult': 3.386160373977308, 'pm_mode': 'martingale', 'martingale_multiplier': 1.3917599585975027, 'martingale_max_steps': 3} because of the following error: NameError("name 'mark_to_market' is not defined").
Traceback (most recent call last):
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\.venv\Lib\site-packages\optuna\study\_optimize.py", line 205, in _run_trial
    value_or_values = func(trial)
                      ^^^^^^^^^^^
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\src\hyperliquid_ohlcv_optimizer\optimize\optuna_worker.py", line 146, in objective
    res = run_backtest(df=df_train, signal=sig_train, config=bt_cfg)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\src\hyperliquid_ohlcv_optimizer\backtest\backtester.py", line 663, in run_backtest
    eq_close = float(mark_to_market(c))
                     ^^^^^^^^^^^^^^
NameError: name 'mark_to_market' is not defined
[W 2025-12-17 03:03:16,385] Trial 0 failed with value None.
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\src\hyperliquid_ohlcv_optimizer\optimize\optuna_worker.py", line 191, in <module>
    main()
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\src\hyperliquid_ohlcv_optimizer\optimize\optuna_worker.py", line 178, in main
    study.optimize(
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\.venv\Lib\site-packages\optuna\study\study.py", line 490, in optimize
    _optimize(
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\.venv\Lib\site-packages\optuna\study\_optimize.py", line 67, in _optimize
    _optimize_sequential(
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\.venv\Lib\site-packages\optuna\study\_optimize.py", line 164, in _optimize_sequential
    frozen_trial_id = _run_trial(study, func, catch)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\.venv\Lib\site-packages\optuna\study\_optimize.py", line 262, in _run_trial
    raise func_err
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\.venv\Lib\site-packages\optuna\study\_optimize.py", line 205, in _run_trial
    value_or_values = func(trial)
                      ^^^^^^^^^^^
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\src\hyperliquid_ohlcv_optimizer\optimize\optuna_worker.py", line 146, in objective
    res = run_backtest(df=df_train, signal=sig_train, config=bt_cfg)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Nahel\Documents\GitHub\quantlab\projects\ohlcv-optimizer-v1\src\hyperliquid_ohlcv_optimizer\backtest\backtester.py", line 663, in run_backtest
    eq_close = float(mark_to_market(c))
                     ^^^^^^^^^^^^^^
NameError: name 'mark_to_market' is not defined
